-- AutoFarm LocalScript (phiÃªn báº£n cÃ³ STATUS chuyÃªn nghiá»‡p, fix lá»—i executor)
-- DÃ¡n vÃ o StarterPlayerScripts hoáº·c PlayerGui (LocalScript)

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local workspace = workspace

-- âš™ï¸ Cáº¥u hÃ¬nh
local SCAN_INTERVAL = 0.1
local SELL_COORDS = Vector3.new(-59, 5, 152)
local rarityRank = {
	Common = 1, Uncommon = 2, Rare = 3,
	Epic = 4, Legendary = 5, Mythic = 6, Unique = 7
}

local fruitKeywords = {"fruit","apple","pear","orange","banana","berry","mango","melon","bomb"}
local blacklist = {"visual","particle","effect","mesh","model","gui","hitbox","trail","spark"}

-- ğŸ§± Táº¡o GUI
local gui = Instance.new("ScreenGui")
gui.Name = "AutoFarmGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,180,0,90)
frame.Position = UDim2.new(0.5,-90,0.85,0)
frame.BackgroundColor3 = Color3.fromRGB(35,35,35)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
frame.BackgroundTransparency = 0.1
frame.ZIndex = 5
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,-10,0,24)
title.Position = UDim2.new(0,5,0,4)
title.BackgroundTransparency = 1
title.Text = "ğŸ‡ Auto Farm"
title.TextColor3 = Color3.new(1,1,1)
title.TextScaled = true
title.Font = Enum.Font.SourceSansBold
title.Parent = frame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1,-10,0,28)
toggleBtn.Position = UDim2.new(0,5,0,28)
toggleBtn.Text = "ğŸ”„ OFF"
toggleBtn.TextScaled = true
toggleBtn.Font = Enum.Font.SourceSansSemibold
toggleBtn.BackgroundColor3 = Color3.fromRGB(90,90,90)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
toggleBtn.ZIndex = 6
toggleBtn.Parent = frame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1,-10,0,24)
statusLabel.Position = UDim2.new(0,5,0,60)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.SourceSansItalic
statusLabel.Text = "â¸ï¸ Äang chá» báº­t..."
statusLabel.Parent = frame

local function setStatus(text, color)
	statusLabel.Text = text
	statusLabel.TextColor3 = color
end

-- ğŸŸ¢ Báº­t/táº¯t
local enabled = false
toggleBtn.MouseButton1Click:Connect(function()
	enabled = not enabled
	if enabled then
		toggleBtn.Text = "âœ… ON"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(50,150,50)
		setStatus("ğŸ” Äang tÃ¬m trÃ¡i...", Color3.fromRGB(255, 255, 0))
	else
		toggleBtn.Text = "ğŸ”„ OFF"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(90,90,90)
		setStatus("â¸ï¸ Äang táº¯t...", Color3.fromRGB(200, 200, 200))
	end
end)

-- ğŸ§© Helpers
local function strtolower(s) return tostring(s):lower() end

local function isFruitObject(obj)
	local n = strtolower(obj.Name)
	local ok = false
	for _, kw in ipairs(fruitKeywords) do
		if n:find(kw) then ok = true break end
	end
	if not ok then return false end
	for _, bad in ipairs(blacklist) do
		if n:find(bad) then return false end
	end
	return true
end

local function getRarity(obj)
	local lower = tostring(obj.Name):lower()
	for rName, _ in pairs(rarityRank) do
		if lower:find(rName:lower()) then
			return rName
		end
	end

	local ok, val = pcall(function()
		return obj:GetAttribute("Rarity")
	end)
	if ok and val then
		return tostring(val)
	end

	local c = obj:FindFirstChild("Rarity")
	if c then
		if c:IsA("StringValue") or c:IsA("ValueBase") then
			return tostring(c.Value)
		end
	end
	return "Unknown"
end

local function rarityValue(r)
	return rarityRank[r] or 0
end

local function safeGetPosition(inst)
	if inst:IsA("BasePart") then return inst.Position end
	local part = inst:FindFirstChildWhichIsA("BasePart", true)
	if part then return part.Position end
	return nil
end

local function findProximityPrompt(obj)
	for _, d in ipairs(obj:GetDescendants()) do
		if d:IsA("ProximityPrompt") then return d end
	end
	return nil
end

local function safeTriggerPrompt(prompt)
	if not prompt or not prompt:IsA("ProximityPrompt") then return false end
	local ok = pcall(function()
		prompt:InputHoldBegin()
		task.wait(0.25)
		prompt:InputHoldEnd()
	end)
	return ok
end

local function scanFruits()
	local found = {}
	for _, obj in ipairs(workspace:GetDescendants()) do
		if isFruitObject(obj) then
			local pos = safeGetPosition(obj)
			if pos then
				local r = getRarity(obj)
				table.insert(found, {instance=obj, rarity=r, rank=rarityValue(r), pos=pos})
			end 
		end
	end
	return found
end

local function findInventory()
	for _, guiObj in ipairs(player.PlayerGui:GetDescendants()) do
		if guiObj:IsA("TextLabel") then
			if string.match(guiObj.Text, "(%d+)%s*/%s*(%d+)") then
				return guiObj
			end
		end
	end
end

local function parseInventoryText(txt)
	if not txt then return 0, 2 end
	local a,b = string.match(txt, "(%d+)%s*/%s*(%d+)")
	if a and b then return tonumber(a), tonumber(b) end
	return 0, 2
end

-- âš¡ AutoFarm loop
task.spawn(function()
	while true do
		task.wait(SCAN_INTERVAL)
		if enabled then
			local label = findInventory()
			local cur, max = 0, 2
			if label then
				cur, max = parseInventoryText(label.Text)
			end

			if cur >= max then
				setStatus("ğŸ’° Äang bÃ¡n táº¥t cáº£...", Color3.fromRGB(0,255,0))
				pcall(function()
					player.Character.HumanoidRootPart.CFrame = CFrame.new(SELL_COORDS)
				end)
				task.wait(0.3)
				for _, p in ipairs(workspace:GetDescendants()) do
					if p:IsA("ProximityPrompt") and tostring(p.Name):lower():find("sell") then
						safeTriggerPrompt(p)
						break
					end
				end
				task.wait(1)
				setStatus("ğŸ” Äang tÃ¬m trÃ¡i...", Color3.fromRGB(255,255,0))
			else
				local fruits = scanFruits()
				table.sort(fruits, function(a,b) return a.rank > b.rank end)
				local target = fruits[1]
				if target then
					setStatus("ğŸ Nháº·t "..(target.rarity or "Unknown").."...", Color3.fromRGB(100,200,255))
					local pos = target.pos
					if pos then
						pcall(function()
							player.Character.HumanoidRootPart.CFrame = CFrame.new(pos + Vector3.new(0,3,0))
						end)
						local prompt = findProximityPrompt(target.instance)
						if prompt then safeTriggerPrompt(prompt) end
						task.wait(0.2)
					end
				else
					setStatus("ğŸ” KhÃ´ng tháº¥y trÃ¡i...", Color3.fromRGB(255,255,0))
				end
			end
		end
	end
end)

print("âœ… AutoFarm Ä‘Ã£ khá»Ÿi Ä‘á»™ng (phiÃªn báº£n á»•n Ä‘á»‹nh cho executor).")
